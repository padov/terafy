version: '3.9'

services:
  evolution-api:
    image: atendai/evolution-api:latest
    container_name: evolution-api-test
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      # Chave de autenticação da API (mude em produção!)
      - AUTHENTICATION_API_KEY=${EVOLUTION_API_KEY:-terafy-test-key-change-me}
      
      # Configurações do servidor
      - SERVER_URL=http://localhost:8080
      - PORT=8080
      
      # Configurações do banco de dados (opcional - Evolution API pode usar SQLite por padrão)
      # Se quiser usar PostgreSQL, descomente e configure:
      # - DATABASE_ENABLED=true
      # - DATABASE_CONNECTION_URI=postgresql://user:password@postgres:5432/evolution
      
      # Configurações do Redis (opcional - para cache)
      # - REDIS_ENABLED=true
      # - REDIS_URI=redis://redis:6379
      
      # Configurações de webhook
      - WEBHOOK_GLOBAL_ENABLED=true
      - WEBHOOK_GLOBAL_URL=http://host.docker.internal:8080/whatsapp/webhook
      - WEBHOOK_GLOBAL_WEBHOOK_BY_EVENTS=true
      
      # Configurações de QR Code
      - QRCODE_LIMIT=30
      - QRCODE_COLOR=#198754
      
      # Logs
      - LOG_LEVEL=ERROR
      - LOG_COLOR=false
      
      # Configurações de segurança
      - CORS_ORIGIN=*
      - CORS_METHODS=GET,POST,PUT,DELETE
      - CORS_CREDENTIALS=true
      
      # Configurações de instância
      - CONFIG_SESSION_PHONE_CLIENT=Chrome
      - CONFIG_SESSION_PHONE_NAME=Chrome
      
    volumes:
      # Persistência de dados (instâncias, tokens, etc)
      - evolution-data:/evolution-api/instances
      - evolution-store:/evolution-api/store
      
    networks:
      - evolution-network
      
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # PostgreSQL (opcional - se quiser usar banco de dados externo)
  # Descomente se quiser usar PostgreSQL ao invés de SQLite
  # postgres:
  #   image: postgres:15-alpine
  #   container_name: evolution-postgres
  #   restart: unless-stopped
  #   environment:
  #     - POSTGRES_DB=evolution
  #     - POSTGRES_USER=evolution
  #     - POSTGRES_PASSWORD=evolution_password_change_me
  #   volumes:
  #     - postgres-data:/var/lib/postgresql/data
  #   networks:
  #     - evolution-network
  #   ports:
  #     - "5433:5432"  # Porta diferente para não conflitar com o PostgreSQL do Terafy

  # Redis (opcional - para cache e melhor performance)
  # Descomente se quiser usar Redis
  # redis:
  #   image: redis:7-alpine
  #   container_name: evolution-redis
  #   restart: unless-stopped
  #   networks:
  #     - evolution-network
  #   ports:
  #     - "6380:6379"  # Porta diferente para não conflitar com outros Redis

volumes:
  evolution-data:
    driver: local
  evolution-store:
    driver: local
  # postgres-data:
  #   driver: local

networks:
  evolution-network:
    driver: bridge

